@page
@model HashMat.Pages.JohnModel
@{
    ViewData["Title"] = "John";
}

<div class="container my-4">
    <div class="row">
        <!-- Left Column: Input Options -->
        <div class="col-md-6">
            <h1 class="mb-4">John the Ripper</h1>

            <p>Configure the settings and click the button to run John the Ripper:</p>

            <form id="runJTRForm" method="post" enctype="multipart/form-data">
                <!-- Input Option Section -->
                <div class="mb-4">
                    <h4>Input Option:</h4>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="inputOption" id="inputOptionInput" value="input" checked>
                        <label class="form-check-label mr-3" for="inputOptionInput">
                            Input
                        </label>
                        <input type="text" class="form-control" name="input" id="input" />
                    </div>

                    <div class="form-check mt-2">
                        <input class="form-check-input" type="radio" name="inputOption" id="inputOptionFile" value="file">
                        <label class="form-check-label mr-3" for="inputOptionFile">
                            File
                        </label>
                        <input type="file" class="form-control-file" name="hashListFile" id="hashListFile" />
                    </div>
                </div>

                <!-- Algorithm Section -->
                <div class="mb-4">
                    <h4 class="mb-3">Algorithm:</h4>
                    <select class="form-control" name="algorithm" id="algorithm">
                        @foreach (var algorithm in Model.Algorithms)
                        {
                            <option value="@algorithm">@algorithm</option>
                        }
                    </select>
                </div>

                <!-- Word List Option Section -->
                <div class="mb-4">
                    <h4>Word List Option:</h4>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="wordListOption" id="wordListOptionNo" value="no-wordlist" checked>
                        <label class="form-check-label mr-3" for="wordListOptionNo">
                            No Word List
                        </label>
                    </div>

                    <div class="form-check mt-2">
                        <input class="form-check-input" type="radio" name="wordListOption" id="wordListOptionFile" value="file">
                        <label class="form-check-label mr-3" for="wordListOptionFile">
                            File
                        </label>
                        <input type="file" class="form-control-file" name="wordListFile" id="wordListFile" />
                    </div>

                    <div class="form-check mt-2">
                        <input class="form-check-input" type="radio" name="wordListOption" id="wordListOptionSelection" value="selection">
                        <label class="form-check-label mr-3" for="wordListOptionSelection">
                            Selection
                        </label>
                        <select class="form-control" name="selectedWordList" id="selectedWordList">
                            @foreach (var wordlist in Model.Wordlists)
                            {
                                <option value="@wordlist">@wordlist</option>
                            }
                            <!-- Add more options as needed -->
                        </select>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="runJTR()">Run John the Ripper</button>
            </form>
        </div>

        <!-- Right Column: Output Container -->
        <div class="col-md-6">
            <div id="output-container">
                <!-- Output will be displayed here -->
            </div>

            <button id="viewResultsButton" disabled class="btn btn-success mt-3" onclick="viewResults()">View Results</button>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.9/signalr.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var connection = new signalR.HubConnectionBuilder()
            .withUrl("/commandHub")
            .build();

        connection.on("ReceiveOutput", function (output) {
            // Append the output to the div
            var outputContainer = document.getElementById("output-container");
            outputContainer.innerHTML += output + "<br/>";
        });

        connection.start().catch(function (err) {
            return console.error(err.toString());
        });

        function runJTR() {
            var formData = new FormData(document.getElementById("runJTRForm"));
            console.log(formData);

            $.ajax({
                type: "POST",
                url: "/John?handler=RunJTR",
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    console.log(data); // Log success message if needed
                    // Enable the view results button
                    $("#viewResultsButton").prop("disabled", false);
                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        }

        function viewResults() {
            // Redirect to a new page or implement logic to display results
            alert("Implement logic to display results here");
        }


    </script>
}
